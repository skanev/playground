> What value of $q$ does `PARTITION` return when all elements in the array $A[p
> \ldots r]$ have the same value? Modify `PARTITION` so that $q = \lfloor
> (p+r)/2 \rfloor$ when all elements in the array $A[p \ldots r]$ have the same
> value.

It returns $r$.

We can modify `PARTITION` by moving numbers smaller than the pivot to the leftmost and numbers equal to the pivot after the smaller group. At last we return the count of smaller group plus half of count the equal numbers.
